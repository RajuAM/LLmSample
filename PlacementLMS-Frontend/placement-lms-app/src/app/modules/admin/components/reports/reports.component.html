<div class="reports-container">
  <div class="reports-header">
    <h1>Reports & Analytics</h1>
    <p>Generate comprehensive reports for student registrations, course subscriptions, placements, and more.</p>
  </div>

  <!-- Report Type Selection -->
  <div class="report-type-section">
    <h3>Select Report Type</h3>
    <div class="report-type-buttons">
      <button
        class="report-type-btn"
        [class.active]="currentReportType === 'students'"
        (click)="onReportTypeChange('students')">
        <i class="icon-users"></i>
        <span>Student Report</span>
      </button>

      <button
        class="report-type-btn"
        [class.active]="currentReportType === 'courses'"
        (click)="onReportTypeChange('courses')">
        <i class="icon-book"></i>
        <span>Course Report</span>
      </button>

      <button
        class="report-type-btn"
        [class.active]="currentReportType === 'placements'"
        (click)="onReportTypeChange('placements')">
        <i class="icon-briefcase"></i>
        <span>Placement Report</span>
      </button>

      <button
        class="report-type-btn"
        [class.active]="currentReportType === 'certificates'"
        (click)="onReportTypeChange('certificates')">
        <i class="icon-certificate"></i>
        <span>Certificate Report</span>
      </button>

      <button
        class="report-type-btn"
        [class.active]="currentReportType === 'progress'"
        (click)="onReportTypeChange('progress')">
        <i class="icon-chart"></i>
        <span>Progress Report</span>
      </button>
    </div>
  </div>

  <!-- Filters Section -->
  <div class="filters-section">
    <div class="filters-header">
      <h3>Report Filters</h3>
      <div class="filter-actions">
        <button class="btn-apply" (click)="onFiltersChange()">Apply Filters</button>
        <button class="btn-clear" (click)="clearFilters()">Clear</button>
      </div>
    </div>

    <form [formGroup]="filterForm" class="filters-form">
      <div class="filters-grid">
        <div class="filter-group">
          <label for="startDate">Start Date:</label>
          <input type="date" id="startDate" formControlName="startDate" class="form-control">
        </div>

        <div class="filter-group">
          <label for="endDate">End Date:</label>
          <input type="date" id="endDate" formControlName="endDate" class="form-control">
        </div>

        <div class="filter-group">
          <label for="department">Department:</label>
          <select id="department" formControlName="department" class="form-control">
            <option value="">All Departments</option>
            <option *ngFor="let dept of departments" [value]="dept">{{ dept }}</option>
          </select>
        </div>

        <div class="filter-group">
          <label for="semester">Semester:</label>
          <select id="semester" formControlName="semester" class="form-control">
            <option value="">All Semesters</option>
            <option *ngFor="let sem of semesters" [value]="sem">{{ sem }}</option>
          </select>
        </div>

        <div class="filter-group" *ngIf="currentReportType === 'courses'">
          <label for="courseCategory">Course Category:</label>
          <select id="courseCategory" formControlName="courseCategory" class="form-control">
            <option value="">All Categories</option>
            <option *ngFor="let cat of courseCategories" [value]="cat">{{ cat }}</option>
          </select>
        </div>

        <div class="filter-group" *ngIf="currentReportType === 'placements'">
          <label for="industry">Industry:</label>
          <select id="industry" formControlName="industry" class="form-control">
            <option value="">All Industries</option>
            <option *ngFor="let ind of industries" [value]="ind">{{ ind }}</option>
          </select>
        </div>
      </div>
    </form>
  </div>

  <!-- Export Options -->
  <div class="export-section">
    <button class="btn-export" (click)="toggleExportOptions()">
      <i class="icon-download"></i>
      Export Report
    </button>

    <div *ngIf="showExportOptions" class="export-options">
      <div class="export-format-buttons">
        <button
          *ngFor="let format of exportFormats"
          class="btn-format"
          (click)="exportReport(format)">
          {{ format.toUpperCase() }}
        </button>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading">
    <div class="loading-spinner"></div>
    <p>Generating report...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="error">
    <div class="error-icon">⚠️</div>
    <p>{{ error }}</p>
    <button class="btn-retry" (click)="loadReport()">Retry</button>
  </div>

  <!-- Report Content -->
  <div *ngIf="!loading && !error && reportData" class="report-content">
    <!-- Student Report -->
    <div *ngIf="currentReportType === 'students'" class="report-section">
      <div class="report-summary">
        <h3>Student Report Summary</h3>
        <div class="summary-stats">
          <div class="stat-item">
            <span class="stat-label">Total Students:</span>
            <span class="stat-value">{{ formatNumber(reportData.totalCount) }}</span>
          </div>
        </div>
      </div>

      <div class="report-table">
        <table class="data-table">
          <thead>
            <tr>
              <th>Student ID</th>
              <th>Name</th>
              <th>Department</th>
              <th>Semester</th>
              <th>CGPA</th>
              <th>Completed Courses</th>
              <th>Certificates</th>
              <th>Placement Status</th>
              <th>Enrollment Date</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let student of reportData.students">
              <td>{{ student.studentId }}</td>
              <td>{{ student.studentName }}</td>
              <td>{{ student.department }}</td>
              <td>{{ student.semester }}</td>
              <td>{{ student.cgpa }}</td>
              <td>{{ student.completedCourses }}/{{ student.totalCourses }}</td>
              <td>{{ student.certificatesEarned }}</td>
              <td>
                <span class="status-badge" [style.background-color]="getStatusColor(student.status)">
                  {{ student.status }}
                </span>
              </td>
              <td>{{ formatDate(student.enrollmentDate) }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Course Report -->
    <div *ngIf="currentReportType === 'courses'" class="report-section">
      <div class="report-summary">
        <h3>Course Report Summary</h3>
        <div class="summary-stats">
          <div class="stat-item">
            <span class="stat-label">Total Courses:</span>
            <span class="stat-value">{{ formatNumber(reportData.totalCourses) }}</span>
          </div>
        </div>
      </div>

      <div class="report-table">
        <table class="data-table">
          <thead>
            <tr>
              <th>Course Title</th>
              <th>Category</th>
              <th>Institution</th>
              <th>Enrollments</th>
              <th>Completion Rate</th>
              <th>Avg Rating</th>
              <th>Price</th>
              <th>Duration</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let course of reportData.courses">
              <td>{{ course.title }}</td>
              <td>{{ course.category }}</td>
              <td>{{ course.institutionName }}</td>
              <td>{{ course.enrollmentCount }}</td>
              <td>
                <div class="progress-bar">
                  <div class="progress-fill" [style.width.%]="course.completionRate"></div>
                  <span class="progress-text">{{ formatPercentage(course.completionRate) }}</span>
                </div>
              </td>
              <td>{{ formatNumber(course.averageRating) }}</td>
              <td>{{ formatCurrency(course.price) }}</td>
              <td>{{ course.durationHours }}h</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Placement Report -->
    <div *ngIf="currentReportType === 'placements'" class="report-section">
      <div class="report-summary">
        <h3>Placement Report Summary</h3>
        <div class="summary-stats">
          <div class="stat-item">
            <span class="stat-label">Total Placements:</span>
            <span class="stat-value">{{ formatNumber(reportData.totalPlacements) }}</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Avg Salary:</span>
            <span class="stat-value">{{ formatCurrency(reportData.salaryAnalytics?.averageSalary) }}</span>
          </div>
        </div>
      </div>

      <div class="report-table">
        <table class="data-table">
          <thead>
            <tr>
              <th>Student</th>
              <th>Company</th>
              <th>Job Title</th>
              <th>Industry</th>
              <th>Salary</th>
              <th>Placement Date</th>
              <th>Location</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let placement of reportData.placements">
              <td>{{ placement.studentName }}</td>
              <td>{{ placement.companyName }}</td>
              <td>{{ placement.jobTitle }}</td>
              <td>{{ placement.industry }}</td>
              <td>{{ formatCurrency(placement.salary) }}</td>
              <td>{{ formatDate(placement.placementDate) }}</td>
              <td>{{ placement.location }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Certificate Report -->
    <div *ngIf="currentReportType === 'certificates'" class="report-section">
      <div class="report-summary">
        <h3>Certificate Report Summary</h3>
        <div class="summary-stats">
          <div class="stat-item">
            <span class="stat-label">Total Certificates:</span>
            <span class="stat-value">{{ formatNumber(reportData.totalCertificates) }}</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Avg Grade:</span>
            <span class="stat-value">{{ formatNumber(reportData.averageGrade) }}</span>
          </div>
        </div>
      </div>

      <div class="report-table">
        <table class="data-table">
          <thead>
            <tr>
              <th>Certificate Title</th>
              <th>Student</th>
              <th>Course</th>
              <th>Institution</th>
              <th>Grade</th>
              <th>Issue Date</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let cert of reportData.certificates">
              <td>{{ cert.certificateTitle }}</td>
              <td>{{ cert.studentName }}</td>
              <td>{{ cert.courseName }}</td>
              <td>{{ cert.institutionName }}</td>
              <td>
                <span class="grade-badge" [style.color]="getGradeColor(cert.grade)">
                  {{ cert.grade }}
                </span>
              </td>
              <td>{{ formatDate(cert.issueDate) }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Progress Report -->
    <div *ngIf="currentReportType === 'progress'" class="report-section">
      <div class="report-summary">
        <h3>Progress Report Summary</h3>
        <div class="summary-stats">
          <div class="stat-item">
            <span class="stat-label">Overall Avg Score:</span>
            <span class="stat-value">{{ formatNumber(reportData.testScores?.overallAverageScore) }}</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Pass Rate:</span>
            <span class="stat-value">{{ formatPercentage(reportData.testScores?.passRate) }}</span>
          </div>
        </div>
      </div>

      <div class="report-table">
        <table class="data-table">
          <thead>
            <tr>
              <th>Student</th>
              <th>Courses Enrolled</th>
              <th>Completed</th>
              <th>In Progress</th>
              <th>Avg Score</th>
              <th>Assignments</th>
              <th>Tests Passed</th>
              <th>Last Activity</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let progress of reportData.studentProgress">
              <td>{{ progress.studentName }}</td>
              <td>{{ progress.totalCoursesEnrolled }}</td>
              <td>{{ progress.completedCourses }}</td>
              <td>{{ progress.inProgressCourses }}</td>
              <td>{{ formatNumber(progress.averageScore) }}</td>
              <td>{{ progress.completedAssignments }}/{{ progress.totalAssignments }}</td>
              <td>{{ progress.passedTests }}/{{ progress.totalTests }}</td>
              <td>{{ formatDate(progress.lastActivity) }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>